# RLT Manager

公開先: https://oyasume.github.io/iidx-rlt/

KONAMIの音楽ゲーム「beatmania IIDX」における、「ランダムレーンチケット」（譜面の配置を固定できるアイテム）の活用を支援するツールです。

主に以下の機能を提供します

- **当たり配置候補の推薦**: 所持しているチケットが、どの曲で当たりになるかの候補を自動で表示します。
- **チケット検索**: 探したい配置を持つチケットを、大量の所持チケットからフィルタリングできます。
- **Textageリンク生成**: チケットを特定の曲で使うと、どんな譜面になるかをワンクリックで確認できます。

<details>
<summary><strong>ランダムレーンチケットについて</strong></summary>

通常、プレイごとに譜面（ノーツの配置）が変わるRANDOMオプションに対し、**譜面をチケット記載の配置に固定できる**課金アイテムです。
300円で10枚購入でき、所持しているチケットとその有効期限のリストは[IIDXの公式サイト](https://p.eagate.573.jp/game/2dx/32/howto/lightning_model/random_lane.html)で確認できます。

</details>

## 背景

ランダムレーンチケットを使うことでランダム譜面の配置を固定できますが、どの曲でそのチケットを使うかを意思決定するのは簡単ではなく、使いきれないまま期限切れになってしまいがちです。
自分はキャンペーンでグッズと交換するポイントを貯める目的で200枚（6000円）ほど購入したものの、ほとんどを無駄にしてしまった経験があります。

Twitterでも同じ悩みや、「大量に購入したのに、当たり配置が1枚もなかった」のような悩みを見かけ、**一見価値のないチケットが実は有効活用できる**ことを発見できるツールがあったら、チケットをもっと利用したくなり、無駄にせずに済むのでは？と思って本アプリケーションを開発しました。

## 課題と解決策

背景の動機から、プレイヤーがランダムレーンチケットを使う際の障壁となっている、以下の3つの課題を洗い出し、解決策を機能として実装しました。

### 課題1：「チケットをどの曲に使えばいいか分からない」

**解決する機能：当たり配置候補の推薦**

所持しているチケットに対し、当たり配置になる曲を自動で推薦します。
チケットをインポートするだけで、ツールが持つ「当たり配置の定義リスト」と自動で照合し、チケット活用のきっかけを作ります。

このツールの当たり配置の定義は「譜面の難所が左右に割れて簡単になる」ことを基準にしており、多くのプレイヤーにとっての「当たり」となるよう考慮しています。
当たり配置は公開された [Google Spread Sheet](https://docs.google.com/spreadsheets/d/e/2PACX-1vTvdia8KZZiRbJ8WmaaFw64HixFWuuYP3HuxYzqfAYKvDso8ITI0OWITchKiv04T57uD2vk0bm9sMFx/pubhtml) で管理しています。

### 課題2：「欲しい配置を、大量のチケットの中から探せない」

**解決する機能：チケット検索機能**

皿（ターンテーブル）側の3鍵盤、非皿側の4鍵盤や、順不同（135と315を区別しない等）を指定して、目的のチケットを絞り込めます。
主にグッズキャンペーンなどで大量にチケットを購入していて、当たり配置の知識がある人が所望のチケットを探す用の機能です。

<details><summary>なぜこの検索形式なのか</summary>

beatmania IIDXの性質上、譜面の当たり外れは **「ターンテーブル側の3鍵盤」と「それ以外の4鍵盤」の組み合わせで判断される** ことがほとんどです。

この事実に着目し、ユーザーが不要な情報を入力することなく、最小限の労力で目的のチケットを探し出せるよう、この検索UIを意図して設計しました。
ほとんどのケースでは左側の3つの鍵盤を指定するだけで、効率的に当たり配置を検索できます。

</details>

### 課題3「チケットを使った場合、どのような譜面になるのかわからない」

**解決する機能：Textageリンク機能**

チケット検索画面で楽曲を選択すると、所持チケットに対して、ワンクリックで外部サイト [Textage](https://textage.cc/) での譜面プレビューを表示できるリンクを生成します。
これにより、ゲームセンターに向かう間や、プレイ待ちで並んでいる時に譜面を確認し、有効であることを確認してからチケットを消化できます。

## 使用技術

- **フロントエンド**: React, TypeScript, Vite, Material-UI, React Hook Form, Zod
- **テスト**: Vitest, Testing Library
- **CI/CD**: GitHub Actions
- **当たり配置定義のデータソース**: Google Spread Sheet
- **コード品質**: ESLint, Prettier

## 技術的なハイライト

ユーザーにとっての利便性、メンテナンス性などを考慮した意志決定について取り上げます。

<details>
<summary><strong>1. 静的サイトとして作る理由</strong></summary>

特別なインストールが不要で、誰でもすぐに使える、かつ維持費用が掛からないことを最優先しました。
また、ユーザーの多くがスマホで利用することを想定し、レスポンシブ対応やPWAとして動くようにもしています。
これはbeatmania IIDXがアーケードゲームのため、ゲームセンターにいるときに利用することを想定したためです。

当初公式サイト上で動くChrome拡張としても開発していましたが、導入の手間やゲームセンターで使えないことが利用の障壁になると判断して廃止し、現在のアーキテクチャを選択しました。

</details>
<details>
<summary><strong>2. 開発体験</strong></summary>

過去の開発経験でビルドの遅さやテスト不足から開発が停滞した反省から、今回は快適で堅牢な開発環境を目指しました。
`Vite`による高速なフィードバック、`Vitest`によるテスト体制の構築とデグレードの回避、`ESLint`, `Prettier`によるコードの一貫性確保などで、開発体験の低下を防いでいます。

</details>
<details>
<summary><strong>3. マスタデータの運用方法</strong></summary>

Textageリンク生成用の楽曲データマスタと、当たり判定の定義リストのような更新頻度の高いデータは、ソースコードとは完全に分離し、`GitHub Actions`経由で更新スクリプトを実行して反映する仕組みを構築しました。

特に当たり配置定義に関しては、手入力しやすい[`Google Spread Sheet`](https://docs.google.com/spreadsheets/d/e/2PACX-1vTvdia8KZZiRbJ8WmaaFw64HixFWuuYP3HuxYzqfAYKvDso8ITI0OWITchKiv04T57uD2vk0bm9sMFx/pubhtml)で定義を管理し、`GitHub Actions`からJSON形式の定義ファイルをビルドするスクリプトが実行されるようにしています。これにより、スマホからでも当たり定義を更新できるなど、Git操作を必要としない運用方法を確保しました。

</details>
